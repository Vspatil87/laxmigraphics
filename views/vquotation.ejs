<%- include('header')%>
    <style>
        .nav-item {
            display: none;
        }
    </style>
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>Quotation</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active">Quotation</li>
                        </ol>
                    </div>
                </div>
            </div>
            <!-- /.container-fluid -->
        </section>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"
            integrity="sha256-c9vxcXyAG4paArQG3xk6DjyW/9aHxai2ef9RpMWO44A=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

        <!-- Main content -->
        <section class="content">

            <!-- Default box -->
            <!-- /.row -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Laxmi Graphics Quotation</h3>
                        </div>
                        <!-- <div class="card-body table-responsive p-0" style="height: 300px;"> -->
                        <div id="content2">
                            <form action="/quotation/insert_quotation" method="POST">
                                <table class="table table-head-fixed text-nowrap" id="table">
                                    <div style="padding: 5px;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="clientid" class="control-label"> <small
                                                        class="req text-danger">
                                                    </small>Customer</label>
                                                <div class="dropdown bootstrap-select ajax-search bs3"
                                                    style="width: 100%;">
                                                    <div class="dropdown bootstrap-select ajax-search bs3 , editdropdown"
                                                        style="width: 100%;">
                                                        <input class="form-control" type="text" />
                                                        <select
                                                            onchange="this.previousElementSibling.value = this.value;"
                                                            id="customer" name="customer_name" class="form-control">
                                                            <% for(var i=0 ; i < result.length ; i++){%>
                                                                <option selected value="<%=result[i].Customer_name%>">
                                                                    <%= result[i].Customer_name%>
                                                                </option>
                                                                <%}%>
                                                        </select>
                                                    </div>
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <p class="bold">Bill To</p>
                                                        <input onclick="edit()" type="text" class="form-control"
                                                            id="address" name="baddress">
                                                        <br>
                                                        <input onclick="edit()" type="text" class="form-control"
                                                            id="city" name="bcity">
                                                        <br>
                                                        <input onclick="edit()" type="text" id="state" name="bstate"
                                                            class="form-control">
                                                        <br>
                                                        <input onclick="edit()" type="text" id="zip_code"
                                                            name="bzipcode" class="form-control">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <p onclick="edit()" class="bold">Ship to</p>
                                                        <input type="text" id="saddress" name="saddress"
                                                            class="form-control">
                                                        <br>
                                                        <input onclick="edit()" type="text" id="scity" name="scity"
                                                            class="form-control">
                                                        <br>
                                                        <input onclick="edit()" type="text" id="sstate" name="sstate"
                                                            class="form-control"><br>
                                                        <input onclick="edit()" type="text" id="szip_code"
                                                            name="szipcode" class="form-control">
                                                    </div>
                                                </div>
                                                <br>
                                                <div class="form-group">
                                                    <label for="number"> <small class="req text-danger">
                                                        </small>Estimate
                                                        Number</label>
                                                    <div class="input-group">
                                                        <span class="input-group-addon , form-control">
                                                            EST- </span>
                                                        <input onclick="edit()" type="text" name="number" id="number"
                                                            class="form-control pending" data-isedit="false"
                                                            data-original-number="false" aria-invalid="false">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group" app-field-wrapper="date"><label
                                                                for="date" class="control-label"> <small
                                                                    class="req text-danger">
                                                                </small>Estimate
                                                                Date</label>
                                                            <div onclick="edit()" class="input-group date"><input
                                                                    type="date" id="date" name="date"
                                                                    class="form-control datepicker" autocomplete="off">
                                                                <div class="input-group-addon">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-group" app-field-wrapper="expirydate"><label
                                                                for="expirydate" class="control-label">Expiry
                                                                Date</label>
                                                            <div onclick="edit()" class="input-group date"><input
                                                                    type="date" id="expirydate" name="expirydate"
                                                                    class="form-control datepicker" autocomplete="off">
                                                                <div class="input-group-addon">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label>Company</label>
                                                <!-- <div class="editdropdown"> -->
                                                <!-- <input type="text" /> -->
                                                <select onclick="edit()" id="company" name='Company'
                                                    class="form-control">
                                                </select>
                                                <!-- </div> -->
                                                <br>
                                                <div>
                                                    <label>Rate</label>
                                                    <input onclick="edit()" type="text" id="price" name="price"
                                                        class="form-control">
                                                </div>
                                                <br>
                                                <div class="form-group">
                                                    <label>Status</label>
                                                    <input onclick="edit()" class="form-control" id="status"
                                                        name="status">
                                                    <br>
                                                    <div class="form-group" app-field-wrapper="sale_agent"><label
                                                            for="sale_agent" class="control-label">Sale Agent</label>
                                                        <div class="dropdown bootstrap-select bs3" style="width: 100%;">
                                                            <div class="dropdown bootstrap-select bs3"
                                                                style="width: 100%;">
                                                                <input onclick="edit()" id="agent" name="saleagent"
                                                                    class="form-control" type="text">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="discount_type"
                                                            class="control-label">Discount</label>
                                                        <div class="dropdown bootstrap-select bs3" style="width: 100%;">
                                                            <div class="dropdown bootstrap-select bs3"
                                                                style="width: 100%;">
                                                                <input onclick="edit()" class="form-control"
                                                                    id="discount" name="discount">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div onclick="edit()" class="form-group" app-field-wrapper="adminnote">
                                                    <label for="adminnote" class="control-label">Note</label><textarea
                                                        id="adminnote" name="adminnote" class="form-control"
                                                        rows="4"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <table id="readroot"
                                        class="table invoice-items-table items table-main-invoice-edit has-calculations no-mtop">
                                        <thead>
                                            <tr>
                                                <th width="10%"><i class="fa fa-exclamation-circle" aria-hidden="true"
                                                        data-toggle="tooltip"
                                                        data-title="New lines are not supported for item description. Use the item long description instead."></i>
                                                    Item</th>
                                                <th width="10%" align="right" class="qty">Qty</th>
                                                <th width="10%" align="right" class="qty">Unit</th>
                                                <th width="15%" align="right">Rate</th>
                                                <th width="10%" align="right">Amount</th>
                                                <th width="20%" align="right">Tax</th>
                                                <th width="10%" align="right">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody class="ui-sortable">
                                            <tr class="main">
                                                <td>
                                                    <div class="editdropdown">
                                                        <select onclick="edit()" id="product" name="product_name"
                                                            class="form-control">
                                                        </select>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input onclick="edit()" onchange="preamount()" type="text" id="qty"
                                                        name="quantity" class="form-control" placeholder="qty"> <br>
                                                </td>
                                                <td>
                                                    <input onclick="edit()" onchange="preamount()" type="text" id="unit"
                                                        name="unit" class="form-control" placeholder="unit">
                                                    <br>
                                                </td>
                                                <td>
                                                    <input onclick="edit()" onchange="preamount()" type="text" id="rate"
                                                        name="rate" class="form-control" placeholder="rate">
                                                    <br>
                                                </td>
                                                <td>
                                                    <input onclick="edit()" type="text" id="amount" name="amount"
                                                        class="form-control" placeholder="total">
                                                    <br>
                                                </td>
                                                <td>
                                                    <input onclick="edit()" onchange="preamount()" id="tax" type="text"
                                                        name="GST" class="form-control" placeholder="GST">
                                                </td>
                                                <td>
                                                    <input onclick="edit()" onchange="preamount()" id="total"
                                                        type="text" name="total" class="form-control"
                                                        placeholder="total">
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <!-- <div class="form-group" app-field-wrapper="adminnote"><label for="adminnote"
                                            class="control-label">Note</label><textarea id="adminnote" name="adminnote"
                                            class="form-control" rows="4"></textarea>
                                    </div> -->
                                    <div style="padding-bottom: 5px;" class="row">
                                        <span id="writeroot"></span>
                                        <div class="col-md-4">
                                            <input class="form-control" type="button" id="moreFields" value="Add" />
                                        </div>
                                        <br>
                                        <div class="col-md-4">
                                            <input class="form-control" type="submit" value="Print"
                                                onclick="window.print()" />
                                        </div>
                                        <div id="copyoutput" style="display: none;"></div>
                                        <div class="col-md-4">
                                            <button class="form-control" type="submit">Save</button>
                                        </div>
                                        <input style="display: none;" name="count" id="count">
                                    </div>
                                </table>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ----------------------------------------------Script to calculate the preamount-----------------------------------------------------------     -->

    <!-- <Script>
        function preamount() {
            var unit = document.getElementById('unit').value;
            var rate = document.getElementById('rate').value;
            var quantity = document.getElementById('qty').value;
            var preamount = document.getElementById('amount').value = parseInt(unit) * parseInt(rate) * parseInt(quantity);
            var gst = document.getElementById('tax').value;
            var amount = Number(preamount / 100) * gst;
            document.getElementById('total').value = amount;
        }
    </Script> -->

    <!-- ----------------------------------------------Selection of product details(unit , rate , qty)--------------------------------------------     -->

    <!-- <script>
        var result;
        jQuery('#product').click('change', function () {
            var cat_name = $('#product option:selected').val();
            jQuery.post('http://localhost:3000/quotation/select_details',
                { product: cat_name },
                function (result, status, jqXHR) {
                    var formoption = "";
                    var formoption2 = "";
                    var formoption3 = "";
                    var preamount = "";
                    for (var i in result.details) {
                        var id = result.details[i].quantity;
                        formoption += result.details[i].quantity;
                        formoption2 += result.details[i].unit;
                        formoption3 += result.details[i].rate;
                        preamount += (formoption * formoption2 * formoption3);
                    }
                    $('#qty').empty();
                    $('#qty').val(formoption).val();
                    $('#unit').empty();
                    $('#unit').val(formoption2).val();
                    $('#rate').empty();
                    $('#rate').val(formoption3).val();
                    $('#amount').empty();
                    $('#amount').val(preamount).val();
                }
            );
        })
    </script> -->

    <!-- ----------------------------------------------Selection of company-------------------------------------------------------     -->

    <script>
        var result;
        jQuery('#customer').click('change', function () {
            var cat_name = $('#customer option:selected').val();
            console.log('cat_name =', cat_name);
            jQuery.post('http://localhost:3000/amanager/select_quotation',
                { name: cat_name },
                function (result, status, jqXHR) {
                    console.log(result.attributes);
                    var formoption = "";
                    var formoption2 = "";
                    var formoption3 = "";
                    var formoption4 = "";
                    var formoption5 = "";
                    var formoption6 = "";
                    var formoption7 = "";
                    var formoption8 = "";
                    var formoption9 = "";
                    var formoption10 = "";
                    var formoption11 = "";
                    var formoption12 = "";
                    var formoption13 = "";
                    var formoption14 = "";
                    var formoption15 = "";
                    var formoption16 = "";
                    var formoption17 = "";
                    console.log('address =', result.quotation.estimate_no);
                    formoption += "<option value='" + result.quotation.company + "'>" + result.quotation.company + "</option>";
                    formoption2 += result.quotation.estimate_no;
                    formoption3 += result.quotation.bill_address;
                    formoption4 += result.quotation.bill_city;
                    formoption5 += result.quotation.bill_state;
                    formoption6 += result.quotation.bill_zip_code;
                    formoption7 += result.quotation.ship_address;
                    formoption8 += result.quotation.ship_city;
                    formoption9 += result.quotation.ship_state;
                    formoption10 += result.quotation.ship_zip_code;
                    formoption11 += result.quotation.estimate_date;
                    formoption12 += result.quotation.expiry_date;
                    formoption13 += result.quotation.rate;
                    formoption14 += result.quotation.status;
                    formoption15 += result.quotation.sale_agent;
                    formoption16 += result.quotation.discount;
                    formoption17 += result.quotation.note;
                    $('#company').empty();
                    $('#company').append(formoption);
                    $('#number').empty();
                    $('#number').val(formoption2).val();
                    $('#address').empty();
                    $('#address').val(formoption3);
                    $('#city').empty();
                    $('#city').val(formoption4).val();
                    $('#state').empty();
                    $('#state').val(formoption5).val();
                    $('#zip_code').empty();
                    $('#zip_code').val(formoption6).val();
                    $('#saddress').empty();
                    $('#saddress').val(formoption7).val();
                    $('#scity').empty();
                    $('#scity').val(formoption8).val();
                    $('#sstate').empty();
                    $('#sstate').val(formoption9).val();
                    $('#szip_code').empty();
                    $('#szip_code').val(formoption10).val();
                    $('#date').empty();
                    $('#date').val(formoption11).val();
                    $('#expirydate').empty();
                    $('#expirydate').val(formoption12).val();
                    $('#price').empty();
                    $('#price').val(formoption13).val();
                    $('#status').empty();
                    $('#status').val(formoption14).val();
                    $('#agent').empty();
                    $('#agent').val(formoption15).val();
                    $('#discount').empty();
                    $('#discount').val(formoption16).val();
                    $('#adminnote').empty();
                    $('#adminnote').val(formoption17).val();

                    var option = "";
                    var option2 = "";
                    var option3 = "";
                    var option4 = "";
                    var option5 = "";
                    var option6 = "";
                    var option7 = "";
                    option += "<option value='" + result.attributes.item + "'>" + result.attributes.item + "</option>";
                    option2 += result.attributes.quantity;
                    option3 += result.attributes.unit;
                    option4 += result.attributes.rate;
                    option5 += result.attributes.amount;
                    option6 += result.attributes.tax;

                    $('#product').empty();
                    $('#product').append(option);
                    $('#qty').empty();
                    $('#qty').val(option2).val();
                    $('#unit').empty();
                    $('#unit').val(option3).val();
                    $('#rate').empty();
                    $('#rate').val(option4).val();
                    $('#amount').empty();
                    $('#amount').val(option5).val();
                    $('#tax').empty();
                    $('#tax').val(option6).val();
                }
            );
        })
    </script>

    <script>
        function edit() {
            document.getElementById('saddress').setAttribute('readonly', true);
            document.getElementById('scity').setAttribute('readonly', true);
            document.getElementById('sstate').setAttribute('readonly', true);
            document.getElementById('szip_code').setAttribute('readonly', true);
            document.getElementById('address').setAttribute('readonly', true);
            document.getElementById('city').setAttribute('readonly', true);
            document.getElementById('state').setAttribute('readonly', true);
            document.getElementById('zip_code').setAttribute('readonly', true);
            document.getElementById('company').setAttribute('readonly', true);
            document.getElementById('number').setAttribute('readonly', true);
            document.getElementById('date').setAttribute('readonly', true);
            document.getElementById('expirydate').setAttribute('readonly', true);
            document.getElementById('price').setAttribute('readonly', true);
            document.getElementById('status').setAttribute('readonly', true);
            document.getElementById('agent').setAttribute('readonly', true);
            document.getElementById('discount').setAttribute('readonly', true);
            document.getElementById('adminnote').setAttribute('readonly', true);
            document.getElementById('product').setAttribute('readonly', true);
            document.getElementById('qty').setAttribute('readonly', true);
            document.getElementById('unit').setAttribute('readonly', true);
            document.getElementById('rate').setAttribute('readonly', true);
            document.getElementById('amount').setAttribute('readonly', true);
            document.getElementById('tax').setAttribute('readonly', true);
        }
    </script>

    <!-- ----------------------------------------------Selection of Ship To address---------------------------------------     -->

    <!-- <script>
        var result;
        jQuery('#company').click('change', function () {
            var cat_name = $('#company option:selected').val();
            console.log('cat_name =', cat_name);
            jQuery.post('http://localhost:3000/quotation/select_saddress',
                { name: cat_name },
                function (result, status, jqXHR) {
                    console.log(result.address);
                    var formoption = "";
                    var formoption2 = "";
                    var formoption3 = "";
                    var formoption4 = "";
                    for (var i in result.address) {
                        var id = result.address[i].Address;
                        console.log('address =', result.address[i].Address);
                        formoption += result.address[i].Address;
                        formoption2 += result.address[i].City;
                        formoption3 += result.address[i].State;
                        formoption4 += result.address[i].Zip_code;
                    }
                    $('#saddress').empty();
                    $('#saddress').val(formoption).val();
                    $('#scity').empty();
                    $('#scity').val(formoption2).val();
                    $('#sstate').empty();
                    $('#sstate').val(formoption3).val();
                    $('#szip_code').empty();
                    $('#szip_code').val(formoption4).val();
                }
            );
        })

    </script> -->

    <!-- ----------------------------------------------Selection of Bill To address---------------------------------------     -->

    <!-- <script>
        var result;
        jQuery('#company').click('change', function () {
            var cat_name = $('#company option:selected').val();
            console.log('cat_name =', cat_name);
            jQuery.post('http://localhost:3000/quotation/select_address',
                { name: cat_name },
                function (result, status, jqXHR) {
                    console.log(result.address);
                    var formoption = "";
                    var formoption2 = "";
                    var formoption3 = "";
                    var formoption4 = "";
                    for (var i in result.address) {
                        var id = result.address[i].Address;
                        console.log('address =', result.address[i].Address);
                        formoption += result.address[i].Address;
                        formoption2 += result.address[i].City;
                        formoption3 += result.address[i].State;
                        formoption4 += result.address[i].Zip_code;
                    }
                    $('#address').empty();
                    $('#address').val(formoption).val();
                    $('#city').empty();
                    $('#city').val(formoption2).val();
                    $('#state').empty();
                    $('#state').val(formoption3).val();
                    $('#zip_code').empty();
                    $('#zip_code').val(formoption4).val();
                }
            );
        })
    </script> -->

    <!-- ----------------------------------------------Script to replicate the flieds---------------------------------------     -->

    <script>
        var counter = 0;
        jQuery('#moreFields').click('change', function moreFields() {
            counter++;
            document.getElementById('count').value = counter;
            var newFields = document.getElementById('readroot').cloneNode(true);
            newFields.id = '';
            newFields.style.display = 'block';
            var newField = newFields.childNodes;
            for (var i = 0; i < newField.length; i++) {
                var theName = newField[i].name
                if (theName)
                    newField[i].name = theName + counter;
            }
            var insertHere = document.getElementById('writeroot');
            insertHere.parentNode.insertBefore(newFields, insertHere);
        })
    </script>

    <%- include('footer')%>